import{i as Q,k as i,o as W,b as X,d as l,w as o,V,l as M,aE as L,aF as Y,M as A,aG as Z,e as s,au as _,aB as ee,t as ae,av as le,aC as te,aH as oe,F as re,n as se,aD as ne,r as ue}from"./index-BKZHNWHs.js";import{c as ie,a as U,u as de,b as B}from"./vee-validate.esm-CdyvAUnP.js";import{b as N}from"./route-block-B_A1xBdJ.js";import{V as me}from"./VRow-C-7Xz0Gv.js";import{V as D}from"./VCol-B0tYhKlf.js";import{V as pe}from"./VDataTableServer-Lc5Kubid.js";import{V as ve}from"./VContainer-6iVz6vnc.js";import{V as ge}from"./VForm-1GUDIreE.js";import{V as ce}from"./filter-C8jmSp9t.js";import{V as E}from"./VTextarea-BNlEFPro.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-7QP_xytx.js";import"./VPagination-B97CDWWk.js";import"./VDivider-BIs3r-G9.js";import"./VList-D5y5XU6S.js";import"./ssrBoot-WWII7APK.js";const fe=se("h1",{class:"text-center"},"商家管理",-1),Ve={__name:"products",setup(be){const{apiAuth:b}=ne(),f=Q(),u=i({open:!1,id:""}),z=t=>{t?(u.value.id=t._id,y.value.value=t.name,w.value.value=t.service,k.value.value=t.description,x.value.value=t.category):u.value.id="",u.value.open=!0},T=()=>{u.value.open=!1,h(),p.value=[],v.value=[],g.value=[]},I=["找設計","找餐具","找家具","找設備","找原料","其他服務"],H=ie({name:U().required("商家名稱必填"),service:U().required("服務項目必填"),description:U().required("商家說明必填"),category:U().required("商家分類必填").test("isCategory","商家分類錯誤",t=>I.includes(t))}),{handleSubmit:K,isSubmitting:P,resetForm:h}=de({validationSchema:H,initialValues:{name:"",service:"",description:"",category:""}}),y=B("name"),w=B("service"),k=B("description"),x=B("category"),p=i([]),v=i([]),g=i([]),G=K(async t=>{var a,n,e,c,m;if(!((a=p.value[0])!=null&&a.error||(n=v.value[0])!=null&&n.error||(e=g.value[0])!=null&&e.error)&&!(u.value.id.length===0&&p.value.length<1&&v.value.length<1&&g.value.length<1))try{const r=new FormData;r.append("name",t.name),r.append("service",t.service),r.append("description",t.description),r.append("category",t.category),p.value.length>0&&r.append("image1",p.value[0].file),v.value.length>0&&r.append("image2",v.value[0].file),g.value.length>0&&r.append("image3",g.value[0].file),u.value.id===""?await b.post("/product",r):await b.patch("/product/"+u.value.id,r),f({text:u.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),T(),d(!0)}catch(r){f({text:((m=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:m.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),S=i(10),C=i([{key:"createdAt",order:"desc"}]),R=i(1),q=i([]),O=[{title:"主圖",align:"center",sortable:!1,key:"image1"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"主視覺",align:"center",sortable:!1,key:"image2"},{title:"服務項目-圖",align:"center",sortable:!1,key:"image3"},{title:"編輯",align:"center",sortable:!1,key:"action"}],$=i(!1),j=i(0),F=i(""),d=async t=>{var a,n,e,c;$.value=!0;try{const m={sortBy:(a=C.value[0])==null?void 0:a.key,sortOrder:(n=C.value[0])==null?void 0:n.order,page:t?1:R.value,itemsPerPage:S.value,search:F.value},{data:r}=await b.get("/product",{params:m});q.value=r.result.data,j.value=r.result.total}catch(m){f({text:((c=(e=m==null?void 0:m.response)==null?void 0:e.data)==null?void 0:c.message)||"發生錯誤",snackbarProps:{color:"red"}})}$.value=!1};d(!0);const J=async t=>{var a,n;try{await b.delete("/product/"+t),f({text:"刪除成功",snackbarProps:{color:"green"}}),d(!0)}catch(e){f({text:((n=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:n.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(t,a)=>{const n=ue("vue-file-agent");return W(),X(re,null,[l(ve,null,{default:o(()=>[l(me,null,{default:o(()=>[l(D,{cols:"12"},{default:o(()=>[fe]),_:1}),l(D,{cols:"12"},{default:o(()=>[l(V,{color:"green",onClick:a[0]||(a[0]=e=>z(null))},{default:o(()=>[M("新增商家")]),_:1})]),_:1}),l(D,{cols:"12"},{default:o(()=>[l(pe,{"items-per-page":S.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=e=>S.value=e),a[7]||(a[7]=e=>d(!1))],"sort-by":C.value,"onUpdate:sortBy":[a[5]||(a[5]=e=>C.value=e),a[8]||(a[8]=e=>d(!1))],page:R.value,"onUpdate:page":[a[6]||(a[6]=e=>R.value=e),a[9]||(a[9]=e=>d(!1))],items:q.value,headers:O,loading:$.value,"items-length":j.value,search:F.value,hover:""},{top:o(()=>[l(L,{label:"搜尋",modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=e=>F.value=e),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=e=>d(!0)),onKeydown:a[3]||(a[3]=Y(e=>d(!0),["enter"]))},null,8,["modelValue"])]),"item.image1":o(({value:e})=>[l(A,{src:e||"default-image-path.png",height:"50px",contain:""},null,8,["src"])]),"item.image2":o(({value:e})=>[l(A,{src:e||"default-image-path.png",height:"50px",contain:""},null,8,["src"])]),"item.image3":o(({value:e})=>[l(A,{src:e||"default-image-path.png",height:"50px",contain:""},null,8,["src"])]),"item.action":o(({item:e})=>[l(V,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:c=>z(e)},null,8,["onClick"]),l(V,{variant:"text",color:"red",icon:"mdi-delete",onClick:c=>J(e._id)},null,8,["onClick"])]),_:1},8,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(oe,{modelValue:u.value.open,"onUpdate:modelValue":a[20]||(a[20]=e=>u.value.open=e),persistent:"",width:"500"},{default:o(()=>[l(ge,{onSubmit:Z(s(G),["prevent"]),disabled:s(P)},{default:o(()=>[l(_,null,{default:o(()=>[l(ee,null,{default:o(()=>[M(ae(u.value.id?"編輯商品":"新增商品"),1)]),_:1}),l(le,null,{default:o(()=>[l(L,{label:"名稱",modelValue:s(y).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>s(y).value.value=e),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(ce,{label:"分類",items:I,modelValue:s(x).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>s(x).value.value=e),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"]),l(E,{label:"服務項目",modelValue:s(w).value.value,"onUpdate:modelValue":a[12]||(a[12]=e=>s(w).value.value=e),"error-messages":s(w).errorMessage.value},null,8,["modelValue","error-messages"]),l(E,{label:"說明",modelValue:s(k).value.value,"onUpdate:modelValue":a[13]||(a[13]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(n,{modelValue:p.value,"onUpdate:modelValue":a[14]||(a[14]=e=>p.value=e),"raw-model-value":t.rawFileRecords1,"onUpdate:rawModelValue":a[15]||(a[15]=e=>t.rawFileRecords1=e),accept:"image/jpeg,image/png",deletable:"","max-size":"5MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 5MB"},ref:"fileAgent1"},null,8,["modelValue","raw-model-value"]),l(n,{modelValue:v.value,"onUpdate:modelValue":a[16]||(a[16]=e=>v.value=e),"raw-model-value":t.rawFileRecords2,"onUpdate:rawModelValue":a[17]||(a[17]=e=>t.rawFileRecords2=e),accept:"image/jpeg,image/png",deletable:"","max-size":"5MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 5MB"},ref:"fileAgent2"},null,8,["modelValue","raw-model-value"]),l(n,{modelValue:g.value,"onUpdate:modelValue":a[18]||(a[18]=e=>g.value=e),"raw-model-value":t.rawFileRecords3,"onUpdate:rawModelValue":a[19]||(a[19]=e=>t.rawFileRecords3=e),accept:"image/jpeg,image/png",deletable:"","max-size":"5MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 5MB"},ref:"fileAgent3"},null,8,["modelValue","raw-model-value"])]),_:1}),l(te,null,{default:o(()=>[l(V,{color:"red",loading:s(P),onClick:T},{default:o(()=>[M("取消")]),_:1},8,["loading"]),l(V,{color:"green",type:"submit",loading:s(P)},{default:o(()=>[M("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof N=="function"&&N(Ve);export{Ve as default};
