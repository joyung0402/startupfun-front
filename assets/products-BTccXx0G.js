import{i as J,k as i,o as Q,b as W,d as l,w as r,V,l as M,aE as L,aF as X,M as A,aG as Y,e as s,au as Z,aB as _,t as ee,av as ae,aC as le,aH as te,F as re,n as oe,aD as se,r as ne}from"./index-BgUX2oQe.js";import{c as ue,a as U,u as ie,b as B}from"./vee-validate.esm-Dt13F5fp.js";import{V as de}from"./VRow-UBv2b7PG.js";import{V as D}from"./VCol-D99dTzcW.js";import{V as me}from"./VDataTableServer-BgqYpc1h.js";import{V as pe}from"./VContainer-CdZqPMGI.js";import{V as ve}from"./VForm-iuEksgv8.js";import{V as ge}from"./filter-bOYYTFwZ.js";import{V as N}from"./VTextarea-CLBIRgre.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VDataTable-Cpy23eqT.js";import"./VPagination-CelbL1cW.js";import"./VDivider-BjLcsRVq.js";import"./VList-BOWOpM5n.js";import"./ssrBoot-DEeHbgD6.js";const ce=oe("h1",{class:"text-center"},"商家管理",-1),Ae={__name:"products",setup(fe){const{apiAuth:b}=se(),f=J(),u=i({open:!1,id:""}),z=t=>{t?(u.value.id=t._id,y.value.value=t.name,w.value.value=t.service,k.value.value=t.description,x.value.value=t.category):u.value.id="",u.value.open=!0},T=()=>{u.value.open=!1,K(),p.value=[],v.value=[],g.value=[]},I=["找設計","找餐具","找家具","找設備","找原料","其他服務"],E=ue({name:U().required("商家名稱必填"),service:U().required("服務項目必填"),description:U().required("商家說明必填"),category:U().required("商家分類必填").test("isCategory","商家分類錯誤",t=>I.includes(t))}),{handleSubmit:H,isSubmitting:P,resetForm:K}=ie({validationSchema:E,initialValues:{name:"",service:"",description:"",category:""}}),y=B("name"),w=B("service"),k=B("description"),x=B("category"),p=i([]),v=i([]),g=i([]),h=H(async t=>{var a,n,e,c,m;if(!((a=p.value[0])!=null&&a.error||(n=v.value[0])!=null&&n.error||(e=g.value[0])!=null&&e.error)&&!(u.value.id.length===0&&p.value.length<1&&v.value.length<1&&g.value.length<1))try{const o=new FormData;o.append("name",t.name),o.append("service",t.service),o.append("description",t.description),o.append("category",t.category),p.value.length>0&&o.append("image1",p.value[0].file),v.value.length>0&&o.append("image2",v.value[0].file),g.value.length>0&&o.append("image3",g.value[0].file),u.value.id===""?await b.post("/product",o):await b.patch("/product/"+u.value.id,o),f({text:u.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),T(),d(!0)}catch(o){f({text:((m=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:m.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),S=i(10),C=i([{key:"createdAt",order:"desc"}]),R=i(1),q=i([]),G=[{title:"主圖",align:"center",sortable:!1,key:"image1"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"主視覺",align:"center",sortable:!1,key:"image2"},{title:"服務項目-圖",align:"center",sortable:!1,key:"image3"},{title:"編輯",align:"center",sortable:!1,key:"action"}],$=i(!1),j=i(0),F=i(""),d=async t=>{var a,n,e,c;$.value=!0;try{const m={sortBy:(a=C.value[0])==null?void 0:a.key,sortOrder:(n=C.value[0])==null?void 0:n.order,page:t?1:R.value,itemsPerPage:S.value,search:F.value},{data:o}=await b.get("/product",{params:m});q.value=o.result.data,j.value=o.result.total}catch(m){f({text:((c=(e=m==null?void 0:m.response)==null?void 0:e.data)==null?void 0:c.message)||"發生錯誤",snackbarProps:{color:"red"}})}$.value=!1};d(!0);const O=async t=>{var a,n;try{await b.delete("/product/"+t),f({text:"刪除成功",snackbarProps:{color:"green"}}),d(!0)}catch(e){f({text:((n=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:n.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(t,a)=>{const n=ne("vue-file-agent");return Q(),W(re,null,[l(pe,null,{default:r(()=>[l(de,null,{default:r(()=>[l(D,{cols:"12"},{default:r(()=>[ce]),_:1}),l(D,{cols:"12"},{default:r(()=>[l(V,{color:"green",onClick:a[0]||(a[0]=e=>z(null))},{default:r(()=>[M("新增商家")]),_:1})]),_:1}),l(D,{cols:"12"},{default:r(()=>[l(me,{"items-per-page":S.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=e=>S.value=e),a[7]||(a[7]=e=>d(!1))],"sort-by":C.value,"onUpdate:sortBy":[a[5]||(a[5]=e=>C.value=e),a[8]||(a[8]=e=>d(!1))],page:R.value,"onUpdate:page":[a[6]||(a[6]=e=>R.value=e),a[9]||(a[9]=e=>d(!1))],items:q.value,headers:G,loading:$.value,"items-length":j.value,search:F.value,hover:""},{top:r(()=>[l(L,{label:"搜尋",modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=e=>F.value=e),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=e=>d(!0)),onKeydown:a[3]||(a[3]=X(e=>d(!0),["enter"]))},null,8,["modelValue"])]),"item.image1":r(({value:e})=>[l(A,{src:e||"default-image-path.png",height:"50px",contain:""},null,8,["src"])]),"item.image2":r(({value:e})=>[l(A,{src:e||"default-image-path.png",height:"50px",contain:""},null,8,["src"])]),"item.image3":r(({value:e})=>[l(A,{src:e||"default-image-path.png",height:"50px",contain:""},null,8,["src"])]),"item.action":r(({item:e})=>[l(V,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:c=>z(e)},null,8,["onClick"]),l(V,{variant:"text",color:"red",icon:"mdi-delete",onClick:c=>O(e._id)},null,8,["onClick"])]),_:1},8,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(te,{modelValue:u.value.open,"onUpdate:modelValue":a[20]||(a[20]=e=>u.value.open=e),persistent:"",width:"500"},{default:r(()=>[l(ve,{onSubmit:Y(s(h),["prevent"]),disabled:s(P)},{default:r(()=>[l(Z,null,{default:r(()=>[l(_,null,{default:r(()=>[M(ee(u.value.id?"編輯商品":"新增商品"),1)]),_:1}),l(ae,null,{default:r(()=>[l(L,{label:"名稱",modelValue:s(y).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>s(y).value.value=e),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(ge,{label:"分類",items:I,modelValue:s(x).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>s(x).value.value=e),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"]),l(N,{label:"服務項目",modelValue:s(w).value.value,"onUpdate:modelValue":a[12]||(a[12]=e=>s(w).value.value=e),"error-messages":s(w).errorMessage.value},null,8,["modelValue","error-messages"]),l(N,{label:"說明",modelValue:s(k).value.value,"onUpdate:modelValue":a[13]||(a[13]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(n,{modelValue:p.value,"onUpdate:modelValue":a[14]||(a[14]=e=>p.value=e),"raw-model-value":t.rawFileRecords1,"onUpdate:rawModelValue":a[15]||(a[15]=e=>t.rawFileRecords1=e),accept:"image/jpeg,image/png",deletable:"","max-size":"5MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 5MB"},ref:"fileAgent1"},null,8,["modelValue","raw-model-value"]),l(n,{modelValue:v.value,"onUpdate:modelValue":a[16]||(a[16]=e=>v.value=e),"raw-model-value":t.rawFileRecords2,"onUpdate:rawModelValue":a[17]||(a[17]=e=>t.rawFileRecords2=e),accept:"image/jpeg,image/png",deletable:"","max-size":"5MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 5MB"},ref:"fileAgent2"},null,8,["modelValue","raw-model-value"]),l(n,{modelValue:g.value,"onUpdate:modelValue":a[18]||(a[18]=e=>g.value=e),"raw-model-value":t.rawFileRecords3,"onUpdate:rawModelValue":a[19]||(a[19]=e=>t.rawFileRecords3=e),accept:"image/jpeg,image/png",deletable:"","max-size":"5MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 5MB"},ref:"fileAgent3"},null,8,["modelValue","raw-model-value"])]),_:1}),l(le,null,{default:r(()=>[l(V,{color:"red",loading:s(P),onClick:T},{default:r(()=>[M("取消")]),_:1},8,["loading"]),l(V,{color:"green",type:"submit",loading:s(P)},{default:r(()=>[M("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};export{Ae as default};
